---
import { Image } from "astro:assets";
import { movieNotFound } from "../../data/movieNotFound";
import type { Movie } from "../../typedefs/Movie";
import PageCard from "../style/PageCard.astro";
import { buttonClasses } from "../style/twClasses/buttonClasses";

const { movie } = Astro.props;

const typedMovie = movie ? movie as Movie : movieNotFound;

const imageUrl = movie.poster && movie.poster !== 'No info available' ? movie.poster : '/images/movieNotFound.jpg';

const {
  title,
  year,
  rated,
  runtime,
  genre,
  director,
  watched
} = movie;

const buttonSwapIdFallback = movie.imdbId ? movie.imdbId : title.split(' ').join('-').toLowerCase(); // we should not have to use this but it is there just in case
const userMovieId = movie.userMovieId ? movie.userMovieId : buttonSwapIdFallback;

const userId = '01J9W2QWVYK5SA1DJ06Q21ZCFW';

const watchedStateParam = watched ? 'watched' : 'unwatched';

---
<PageCard>
  <div class="flex flex-row items-between justify-between">
    <Image src={imageUrl} alt={movie.title} width={100} height={75} />

    <div class="flex flex-col items-end justify-end">
      <h1 class="text-xl lg:text-2xl font-bold">{title}</h1>
      <h2 class="text-lg lg:text-xl">{year}</h2>
      <h2 class="text-lg lg:text-xl">{rated}</h2>
      <h2 class="text-lg lg:text-xl">{genre}</h2>
      <div 
        id={`watched-div-${userMovieId}`}
        class="mt-4"
      >
        <button
          id={`watched-button-${userMovieId}`}
          class={buttonClasses}
          hx-post={`/partials/user/toggle/${userId}/${userMovieId}/?watched=${watchedStateParam}`}
          hx-trigger="click"
          hx-target={`#watched-div-${userMovieId}`}
          hx-swap="innerHTML"
        >
          {watched ? 'Watched' : 'To Watch'}
        </button>
      </div>
  </div>
</PageCard>
